---
import { translations } from "../i18n/translations";
import { languages, languageKeys, defaultLang, showDefaultLang } from "../i18n/ui";
import type { UILanguages } from "../i18n/ui";
import { resolveCanonical, resolveLocalized } from "../i18n/rootMap";

const segments = Astro.url.pathname.split("/").filter(Boolean);
const lang = segments[0] as UILanguages;
const rawSection = segments[1];
const slug = segments.slice(2).join("/");

const canonicalSection = resolveCanonical(rawSection, lang);
const isDetailPage = Boolean(slug);

const availableLocales = isDetailPage
  ? translations[canonicalSection as keyof typeof translations]?.[slug] || {}
  : {};

const isTagPage = slug.startsWith("tags");
---

<div class="language-picker">
  {languageKeys.map((targetLang) => {
    const label = languages[targetLang];
    const langPrefix =
      targetLang === defaultLang && !showDefaultLang ? "" : `/${targetLang}`;
    const localizedSection = resolveLocalized(canonicalSection, targetLang);


    // 游늷 Caso 1: p치gina de tags (sin traducci칩n de "tag")
    if (isTagPage) {
      return <a href={`${langPrefix}/${localizedSection}/${slug}`}>{label}</a>;
    }

    // 游늷 Caso 2: p치ginas de detalle dentro de colecciones
    if (isDetailPage && canonicalSection in translations) {
      const entry = availableLocales[targetLang];
      if (!entry) {
        return <span class="disabled">{label} 游</span>;
      }
      return (
        <a href={`${langPrefix}/${localizedSection}/${entry.slug}`}>
          {label}
        </a>
      );
    }

    // 游늷 Caso 3: 칤ndice de colecci칩n (ej. /es/blog) o p치ginas est치ticas (ej. /es/about)
    return <a href={`${langPrefix}/${localizedSection}`}>{label}</a>;
  })}
</div>
